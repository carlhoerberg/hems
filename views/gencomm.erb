# TYPE genset_voltage gauge
# TYPE genset_current gauge
# TYPE genset_kw gauge
# TYPE genset_kva gauge
# TYPE genset_kvar gauge
# TYPE genset_load_pct gauge
<%[1, 2, 3].each do |l|%>
genset_voltage{name="<%=name%>",L="<%=l%>"} <%=measurements["voltage_l#{l}_n".to_sym]%>
genset_current{name="<%=name%>",L="<%=l%>"} <%=measurements["current_l#{l}".to_sym]%>
genset_kw{name="<%=name%>",L="<%=l%>"} <%=measurements["watts_l#{l}".to_sym] / 1000.0%>
genset_kva{name="<%=name%>",L="<%=l%>"} <%=measurements["kva_l#{l}".to_sym]%>
genset_kvar{name="<%=name%>",L="<%=l%>"} <%=measurements["kvar_l#{l}".to_sym]%>
genset_load_pct{name="<%=name%>",L="<%=l%>"} <%=measurements["load_pct_l#{l}".to_sym]%>
<%end%>

# TYPE genset_frequency gauge
genset_frequency{name="<%=name%>"} <%=measurements[:frequency]%>
# TYPE genset_rpm gauge
genset_rpm{name="<%=name%>"} <%=measurements[:rpm]%>
# TYPE genset_battery_voltage gauge
genset_battery_voltage{name="<%=name%>"} <%=measurements[:battery_voltage]%>
# TYPE genset_fuel_level gauge
genset_fuel_level{name="<%=name%>"} <%=measurements[:fuel_level]%>
# TYPE genset_coolant_temperature gauge
genset_coolant_temperature{name="<%=name%>"} <%=measurements[:coolant_temperature]%>
# TYPE genset_oil_pressure gauge
genset_oil_pressure{name="<%=name%>"} <%=measurements[:oil_pressure]%>
# TYPE genset_oil_temperature gauge
genset_oil_temperature{name="<%=name%>"} <%=measurements[:oil_temperature]%>
# TYPE genset_turbo_pressure gauge
genset_turbo_pressure{name="<%=name%>"} <%=measurements[:turbo_pressure]%>
# TYPE genset_fuel_consumption gauge
genset_fuel_consumption{name="<%=name%>"} <%=measurements[:fuel_consumption]%>
# TYPE genset_aftertreatment_temp gauge
genset_aftertreatment_temp{name="<%=name%>"} <%=measurements[:aftertreatment_temp]%>
# TYPE genset_engine_torque_pct gauge
genset_engine_torque_pct{name="<%=name%>"} <%=measurements[:engine_torque_pct]%>
# TYPE genset_soot_load gauge
genset_soot_load{name="<%=name%>"} <%=measurements[:soot_load]%>
# TYPE genset_ash_load gauge
genset_ash_load{name="<%=name%>"} <%=measurements[:ash_load]%>
# TYPE genset_dpf_regen_status gauge
genset_dpf_regen_status{name="<%=name%>"} <%=measurements[:dpf_regen_status]%>
# TYPE genset_kwh counter
genset_kwh{name="<%=name%>"} <%=accumulated[:kwh_positive]%>
# TYPE genset_start_counter counter
genset_start_counter{name="<%=name%>"} <%=accumulated[:start_counter]%>
# TYPE genset_engine_run_time counter
genset_engine_run_time{name="<%=name%>"} <%=accumulated[:engine_run_time]%>
# TYPE genset_status gauge
genset_status{name="<%=name%>"} <%=status%>

# TYPE metrics_gather_time gauge
metrics_gather_time{device="gencomm"} <%=Process.clock_gettime(Process::CLOCK_MONOTONIC) - t%>
